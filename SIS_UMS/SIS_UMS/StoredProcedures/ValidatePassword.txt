CREATE DEFINER=`root`@`localhost` PROCEDURE `ValidatePassword`(
    IN input_username INT,
    IN input_password VARCHAR(255),
    OUT is_valid BOOLEAN
)
BEGIN
    -- Declare local variables
    DECLARE user_salt VARCHAR(255);
    DECLARE hashed_password VARCHAR(255);
    DECLARE combined_password VARCHAR(255);
    DECLARE entered_password_hash VARCHAR(255);

    -- Step 1: Retrieve the user's salt and hashed password from the database based on the username
    SELECT password_salt, user_password INTO user_salt, hashed_password
    FROM users
    WHERE username = input_username;

    -- Step 2: Check if the user exists
    IF user_salt IS NULL OR hashed_password IS NULL THEN
        -- User does not exist
        SET is_valid = FALSE;
    ELSE
        -- Step 3: Concatenate the input password with the user's salt
        SET combined_password = CONCAT(input_password, user_salt);

        -- Step 4: Hash the concatenated password using SHA-256
        SET entered_password_hash = SHA2(combined_password, 256);

        -- Step 5: Compare the computed hash with the stored hash
        IF HEX(entered_password_hash) = hashed_password THEN
            -- Password is valid
            SET is_valid = TRUE;
        ELSE
            -- Password is not valid
            SET is_valid = FALSE;
        END IF;
    END IF;
END